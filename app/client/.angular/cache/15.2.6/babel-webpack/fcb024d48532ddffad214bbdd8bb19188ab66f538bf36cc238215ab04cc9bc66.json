{"ast":null,"code":"import _defineProperty from \"/Users/malaklahlou/Downloads/Car_Website/app/client/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport { FormBuilder, Validators } from '@angular/forms';\nimport { CommunicationService } from 'src/app/services/communication.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"src/app/services/communication.service\";\nfunction MemberPageComponent_option_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const option_r4 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", option_r4);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(option_r4);\n  }\n}\nfunction MemberPageComponent_option_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const option_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", option_r5);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(option_r5);\n  }\n}\nfunction MemberPageComponent_option_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const option_r6 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", option_r6);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(option_r6);\n  }\n}\nfunction MemberPageComponent_option_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const option_r7 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", option_r7);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(option_r7);\n  }\n}\nexport let MemberPageComponent = /*#__PURE__*/(() => {\n  class MemberPageComponent {\n    constructor(formBuilder, communicationService) {\n      _defineProperty(this, \"formBuilder\", void 0);\n      _defineProperty(this, \"communicationService\", void 0);\n      _defineProperty(this, \"registrationForm\", void 0);\n      _defineProperty(this, \"placeOptions\", []);\n      _defineProperty(this, \"coopMemberOptions\", []);\n      _defineProperty(this, \"carpoolingMemberOptions\", []);\n      _defineProperty(this, \"allVehicles\", []);\n      _defineProperty(this, \"vehicleOptions\", []);\n      _defineProperty(this, \"isVehicleOptionsEmpty\", false);\n      _defineProperty(this, \"newReservationId\", void 0);\n      _defineProperty(this, \"allPlaces\", 'Tous les emplacements');\n      this.formBuilder = formBuilder;\n      this.communicationService = communicationService;\n    }\n    ngOnInit() {\n      this.registrationForm = this.formBuilder.group({\n        member: ['', Validators.required],\n        place: ['', Validators.required],\n        startDate: ['', Validators.required],\n        endDate: ['', Validators.required],\n        requirements: [null],\n        vehicle: ['', Validators.required]\n      });\n      this.communicationService.getLocations().subscribe(response => {\n        if (response) {\n          this.placeOptions = response.map(location => location.nomemplacement);\n          this.placeOptions.unshift(this.allPlaces);\n          if (this.placeOptions.length > 0) {\n            this.registrationForm.patchValue({\n              place: this.placeOptions[0]\n            });\n          }\n        }\n      });\n      this.communicationService.getCoopMembers().subscribe(response => {\n        if (response) {\n          this.coopMemberOptions = response.map(member => member.prenom + ' ' + member.nom + ' (' + member.mid + ')');\n          this.registrationForm.patchValue({\n            member: this.coopMemberOptions[0]\n          });\n        }\n      });\n      this.communicationService.getCarpoolingMembers().subscribe(response => {\n        if (response) {\n          this.carpoolingMemberOptions = response.map(member => member.prenom + ' ' + member.nom + ' (' + member.mid + ')');\n        }\n      });\n      this.communicationService.getVehicles().subscribe(response => {\n        if (response) {\n          this.allVehicles = response;\n          this.onSelect(this.allPlaces);\n          this.registrationForm.patchValue({\n            vehicle: this.vehicleOptions[0]\n          });\n        }\n      });\n      this.communicationService.getLastReservation().subscribe(response => {\n        if (response) {\n          this.newReservationId = this.createNewReservationId(response[0].reservationid);\n        }\n      });\n    }\n    onSubmit() {\n      if (this.isVehicleOptionsEmpty) {\n        alert('Aucun véhicule disponible pour cet emplacement');\n        return;\n      }\n      const startDate = this.registrationForm.value.startDate;\n      const endDate = this.registrationForm.value.endDate;\n      if (!this.isValidDate(startDate, endDate)) {\n        alert('La date de début doit être antérieure à la date de fin');\n        return;\n      }\n      if (this.registrationForm.valid) {\n        const reservation = {\n          reservationid: this.newReservationId,\n          reservationstart: this.registrationForm.value.startDate,\n          reservationend: this.registrationForm.value.endDate,\n          exigencessup: this.registrationForm.value.requirements,\n          vehiculeid: this.extractEntityId(this.registrationForm.value.vehicle),\n          mid: +this.extractEntityId(this.registrationForm.value.member)\n        };\n        this.communicationService.addReservation(reservation).subscribe(response => {});\n        alert('Réservation créée avec succès');\n      }\n    }\n    isValidDate(startDate, endDate) {\n      const startDateObj = new Date(startDate);\n      const endDateObj = new Date(endDate);\n      return startDateObj < endDateObj;\n    }\n    extractEntityId(entity) {\n      const entityId = entity.slice(entity.indexOf('(') + 1, entity.indexOf(')'));\n      return entityId;\n    }\n    createNewReservationId(lastReservationId) {\n      const lastReservationIdNumber = Number(lastReservationId.slice(3));\n      const newReservationIdNumber = lastReservationIdNumber + 1;\n      const paddedNewReservationIdNumber = newReservationIdNumber.toString().padStart(4, '0');\n      return 'RSV' + paddedNewReservationIdNumber;\n    }\n    onSelect(selectedPlace) {\n      if (selectedPlace === this.allPlaces) {\n        this.vehicleOptions = this.allVehicles.map(vehicle => vehicle.marque + ' ' + vehicle.modele + ' (' + vehicle.plaqueimmatriculation + ')' + ' - ' + vehicle.nomemplacement);\n        this.isVehicleOptionsEmpty = false;\n      } else {\n        this.vehicleOptions = this.allVehicles.filter(vehicle => vehicle.nomemplacement === selectedPlace).map(vehicle => vehicle.marque + ' ' + vehicle.modele + ' (' + vehicle.plaqueimmatriculation + ')' + ' - ' + vehicle.nomemplacement);\n        this.isVehicleOptionsEmpty = false;\n      }\n      if (this.vehicleOptions.length === 0) {\n        this.vehicleOptions.push('Aucun véhicule disponible');\n        this.isVehicleOptionsEmpty = true;\n      }\n    }\n  }\n  _defineProperty(MemberPageComponent, \"\\u0275fac\", function MemberPageComponent_Factory(t) {\n    return new (t || MemberPageComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.CommunicationService));\n  });\n  _defineProperty(MemberPageComponent, \"\\u0275cmp\", /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: MemberPageComponent,\n    selectors: [[\"app-member-page\"]],\n    decls: 28,\n    vars: 5,\n    consts: [[1, \"center-container\"], [3, \"formGroup\", \"ngSubmit\"], [\"for\", \"member\"], [\"name\", \"member\", \"formControlName\", \"member\"], [\"label\", \"Membre coop\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"label\", \"Membre autopartage\"], [\"for\", \"place\"], [\"name\", \"place\", \"formControlName\", \"place\", 3, \"change\"], [\"type\", \"datetime-local\", \"formControlName\", \"startDate\"], [\"type\", \"datetime-local\", \"formControlName\", \"endDate\"], [\"for\", \"requirements\"], [\"type\", \"text\", \"name\", \"requirements\", \"formControlName\", \"requirements\"], [\"for\", \"vehicle\"], [\"name\", \"vehicle\", \"formControlName\", \"vehicle\"], [\"type\", \"submit\"], [3, \"value\"]],\n    template: function MemberPageComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"form\", 1);\n        i0.ɵɵlistener(\"ngSubmit\", function MemberPageComponent_Template_form_ngSubmit_1_listener() {\n          return ctx.onSubmit();\n        });\n        i0.ɵɵelementStart(2, \"label\", 2);\n        i0.ɵɵtext(3, \"Membre\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"select\", 3)(5, \"optgroup\", 4);\n        i0.ɵɵtemplate(6, MemberPageComponent_option_6_Template, 2, 2, \"option\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"optgroup\", 6);\n        i0.ɵɵtemplate(8, MemberPageComponent_option_8_Template, 2, 2, \"option\", 5);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(9, \"label\", 7);\n        i0.ɵɵtext(10, \"Emplacement\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"select\", 8);\n        i0.ɵɵlistener(\"change\", function MemberPageComponent_Template_select_change_11_listener($event) {\n          return ctx.onSelect($event.target.value);\n        });\n        i0.ɵɵtemplate(12, MemberPageComponent_option_12_Template, 2, 2, \"option\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(13, \"label\");\n        i0.ɵɵtext(14, \"Date de d\\u00E9but\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(15, \"input\", 9);\n        i0.ɵɵelementStart(16, \"label\");\n        i0.ɵɵtext(17, \"Date de fin\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(18, \"input\", 10);\n        i0.ɵɵelementStart(19, \"label\", 11);\n        i0.ɵɵtext(20, \"Exigences suppl\\u00E9mentaires\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(21, \"input\", 12);\n        i0.ɵɵelementStart(22, \"label\", 13);\n        i0.ɵɵtext(23, \"V\\u00E9hicule\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"select\", 14);\n        i0.ɵɵtemplate(25, MemberPageComponent_option_25_Template, 2, 2, \"option\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(26, \"button\", 15);\n        i0.ɵɵtext(27, \"Cr\\u00E9er la r\\u00E9servation\");\n        i0.ɵɵelementEnd()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"formGroup\", ctx.registrationForm);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngForOf\", ctx.coopMemberOptions);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.carpoolingMemberOptions);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngForOf\", ctx.placeOptions);\n        i0.ɵɵadvance(13);\n        i0.ɵɵproperty(\"ngForOf\", ctx.vehicleOptions);\n      }\n    },\n    styles: [\".center-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh}.auth-container[_ngcontent-%COMP%]{background-color:#f5f5f5;border:1px solid #ccc;padding:20px}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:300px}label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:10px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:10px;border-radius:5px;border:1px solid #ccc;margin-bottom:20px}button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;font-size:1.2rem;padding:.5rem 1rem;border:none;border-radius:.3rem;cursor:pointer;transition:background-color .2s}.alert[_ngcontent-%COMP%]{display:flex;color:red;font-weight:700}\"]\n  }));\n  return MemberPageComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}